<h1>New pickup</h1>

<%= render 'form' %>

<script>
var POSITION_TIMEOUT = 5000;

function show_map(position) {
    // console.debug("Coordinates found: " + lat + ", " + lng);
  $("#pickup_latitude").val(position.coords.latitude);
  $("#pickup_longitude").val(position.coords.longitude);
  searchLocation(position.coords.latitude, position.coords.longitude);
}

function handle_error(err) {
  console.error("Location not found: " + err);
  if (err.code == 3 && loc_retries == 0) {
    navigator.geolocation.getCurrentPosition(show_map, handle_error, {timeout: POSITION_TIMEOUT, enableHighAccuracy: false});
  } else {
    $('#pickup_location').attr('placeholder', '');
  }
}

// Init
$(document).ready(function() {
  $('#pickups_location').attr('placeholder', 'Searching for location...');

  // Adds datepicker if there isn't native control
  if (!isDateControlSupported()) {
    $('#pickup_picked_at_date').datepicker({format: 'dd/mm/yyyy', weekStart: 1});
  }

  // Search location 
  navigator.geolocation.getCurrentPosition(show_map, handle_error, {timeout: POSITION_TIMEOUT, enableHighAccuracy: true});
});
</script>
